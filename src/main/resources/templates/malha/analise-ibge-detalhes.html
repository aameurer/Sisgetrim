<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}">

<head>
    <title>Detalhes do Registro IBGE | SISgetrim</title>
</head>

<body class="bg-slate-50">
    <section layout:fragment="content" class="space-y-6">
        <div class="p-8">
            <!-- Breadcrumb -->
            <nav class="mb-6 text-sm animate-in fade-in slide-in-from-top-4 duration-500">
                <a href="/dashboard" class="text-slate-400 hover:text-indigo-600 transition-colors">Dashboard</a>
                <span class="text-slate-300 mx-2">→</span>
                <a href="/malha/analise-ibge" class="text-slate-400 hover:text-indigo-600 transition-colors">Análise
                    IBGE</a>
                <span class="text-slate-300 mx-2">→</span>
                <span class="text-slate-700 font-bold">Registro #<span th:text="${ibge.id}">000</span></span>
            </nav>

            <!-- Alerts -->
            <div th:if="${mensagemSucesso}"
                class="mb-6 p-4 bg-emerald-50 border border-emerald-100 text-emerald-700 rounded-2xl flex items-center space-x-3 animate-in fade-in slide-in-from-right-4 duration-500">
                <i class="fas fa-check-circle text-lg"></i>
                <span class="text-sm font-bold" th:text="${mensagemSucesso}">Sucesso!</span>
            </div>

            <form th:action="@{/malha/analise-ibge/{id}/salvar(id=${ibge.id})}" th:object="${ibge}" method="post">
                <!-- Header -->
                <div class="flex justify-between items-center mb-8 animate-in fade-in slide-in-from-top-4 duration-700">
                    <div>
                        <h1 class="text-2xl font-black text-slate-800 uppercase tracking-tight">
                            Detalhes do Registro IBGE
                        </h1>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">
                            Visualização e Edição de Dados da Declaração
                        </p>
                    </div>
                    <div class="flex space-x-3">
                        <a href="/malha/analise-ibge"
                            class="px-4 py-2 bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 font-bold text-sm rounded-2xl transition-all active:scale-95 flex items-center space-x-2 shadow-sm">
                            <i class="fas fa-arrow-left text-xs"></i>
                            <span>Voltar</span>
                        </a>
                        <button type="submit"
                            class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-sm rounded-2xl transition-all active:scale-95 flex items-center space-x-2 shadow-lg shadow-indigo-200">
                            <i class="fas fa-save text-xs"></i>
                            <span>Salvar Alterações</span>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    <!-- Coluna 1: Dados do Cartório e Partes -->
                    <div class="space-y-8">
                        <!-- Card: Informações do Cartório -->
                        <div
                            class="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/40 border border-slate-100 p-8">
                            <div class="flex items-center space-x-4 mb-8 pb-4 border-b border-slate-50">
                                <div class="h-12 w-12 rounded-2xl bg-indigo-100 flex items-center justify-center">
                                    <i class="fas fa-building-columns text-indigo-600 text-lg"></i>
                                </div>
                                <div>
                                    <h2 class="text-base font-black text-slate-700 uppercase tracking-tight">Dados do
                                        Cartório</h2>
                                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">
                                        Identificação da Serventia</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="col-span-full">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Nome
                                        do Cartório</label>
                                    <input type="text" th:field="*{nomeCartorio}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">CNS</label>
                                    <input type="number" th:field="*{cns}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Data
                                        Lavratura / Reg.</label>
                                    <input type="date" th:field="*{dataLavraturaRegistroAverbacao}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Tipo
                                        de Serviço</label>
                                    <input type="text" th:field="*{tipoServico}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Tipo
                                        de Declaração</label>
                                    <input type="text" th:field="*{tipoDeclaracao}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                            </div>
                        </div>

                        <!-- Card: Partes Envolvidas -->
                        <div
                            class="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/40 border border-slate-100 p-8">
                            <div class="flex items-center space-x-4 mb-8 pb-4 border-b border-slate-50">
                                <div class="h-12 w-12 rounded-2xl bg-blue-100 flex items-center justify-center">
                                    <i class="fas fa-users text-blue-600 text-lg"></i>
                                </div>
                                <div>
                                    <h2 class="text-base font-black text-slate-700 uppercase tracking-tight">Partes
                                        Envolvidas</h2>
                                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">Alienantes
                                        e Adquirentes</p>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <!-- Listagem de Alienantes -->
                                <div class="p-4 bg-rose-50/50 rounded-2xl border border-rose-100/50">
                                    <div class="flex items-center space-x-2 mb-3">
                                        <div class="w-1.5 h-1.5 rounded-full bg-rose-500"></div>
                                        <span
                                            class="text-[10px] font-black text-rose-600 uppercase tracking-widest">Alienantes</span>
                                    </div>
                                    <div class="space-y-4">
                                        <div th:each="alienante, stat : *{alienantes}"
                                            class="bg-white p-4 rounded-xl border border-rose-100 shadow-sm space-y-2">
                                            <div class="flex justify-between items-center">
                                                <span
                                                    class="px-2 py-0.5 bg-rose-50 text-rose-500 text-[8px] font-black rounded-lg uppercase">Alienante</span>
                                                <p class="text-[9px] font-bold text-slate-400 italic"
                                                    th:text="${alienante.id}">ID</p>
                                            </div>
                                            <div>
                                                <label
                                                    class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">NI
                                                    (CPF/CNPJ)</label>
                                                <input type="text" th:field="*{alienantes[__${stat.index}__].ni}"
                                                    class="w-full bg-slate-50 border-slate-200 rounded-xl p-2 text-[11px] font-bold text-slate-700 focus:ring-1 focus:ring-rose-500/20 focus:border-rose-300 transition-all font-mono ni-mask">
                                            </div>
                                            <div class="pt-1 border-t border-slate-50">
                                                <p class="text-[10px] font-black text-slate-600"
                                                    th:text="${__${'nomeAlienante_' + alienante.id}__}">
                                                    Nome não encontrado</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Listagem de Adquirentes -->
                                <div class="p-4 bg-emerald-50/50 rounded-2xl border border-emerald-100/50">
                                    <div class="flex items-center space-x-2 mb-3">
                                        <div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                                        <span
                                            class="text-[10px] font-black text-emerald-600 uppercase tracking-widest">Adquirentes</span>
                                    </div>
                                    <div class="space-y-4">
                                        <div th:each="adquirente, stat : *{adquirentes}"
                                            class="bg-white p-4 rounded-xl border border-emerald-100 shadow-sm space-y-2">
                                            <div class="flex justify-between items-center">
                                                <span
                                                    class="px-2 py-0.5 bg-emerald-50 text-emerald-500 text-[8px] font-black rounded-lg uppercase">Adquirente</span>
                                                <p class="text-[9px] font-bold text-slate-400 italic"
                                                    th:text="${adquirente.id}">ID</p>
                                            </div>
                                            <div>
                                                <label
                                                    class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">NI
                                                    (CPF/CNPJ)</label>
                                                <input type="text" th:field="*{adquirentes[__${stat.index}__].ni}"
                                                    class="w-full bg-slate-50 border-slate-200 rounded-xl p-2 text-[11px] font-bold text-slate-700 focus:ring-1 focus:ring-emerald-500/20 focus:border-emerald-300 transition-all font-mono ni-mask">
                                            </div>
                                            <div class="pt-1 border-t border-slate-50">
                                                <p class="text-[10px] font-black text-slate-600"
                                                    th:text="${__${'nomeAdquirente_' + adquirente.id}__}">
                                                    Nome não encontrado</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Coluna 2: Dados do Imóvel e Matrícula -->
                    <div class="space-y-8">
                        <!-- Card: Cadastro Imobiliário e Matrícula -->
                        <div
                            class="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/40 border border-slate-100 p-8">
                            <div class="flex items-center space-x-4 mb-8 pb-4 border-b border-slate-50">
                                <div class="h-12 w-12 rounded-2xl bg-amber-100 flex items-center justify-center">
                                    <i class="fas fa-home text-amber-600 text-lg"></i>
                                </div>
                                <div>
                                    <h2 class="text-base font-black text-slate-700 uppercase tracking-tight">Imóvel e
                                        Registro</h2>
                                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">Dados
                                        Físicos e Jurídicos</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="lg:col-span-2">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Matrícula</label>
                                    <input type="text" th:field="*{matricula}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Transcrição</label>
                                    <input type="text" th:field="*{transcricao}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono">
                                </div>
                                <div class="lg:col-span-1.5">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Cód.
                                        Nac. Matrícula</label>
                                    <input type="text" th:field="*{codigoNacionalMatricula}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono">
                                </div>
                                <div class="lg:col-span-1.5">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Matr.
                                        Notarial Eletrônica</label>
                                    <input type="text" th:field="*{matriculaNotarialEletronica}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono">
                                </div>
                                <div class="col-span-full">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Tipo
                                        de Operação</label>
                                    <input type="text" th:field="*{tipoOperacaoImobiliaria}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div class="col-span-full">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Outras
                                        Operações (Descrição)</label>
                                    <textarea th:field="*{descricaoOutrasOperacoesImobiliarias}" rows="2"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all"></textarea>
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Insc.
                                        Municipal</label>
                                    <input type="text" th:field="*{inscricaoMunicipal}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Destinação</label>
                                    <input type="text" th:field="*{destinacao}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">CIB</label>
                                    <input type="text" th:field="*{cib}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono">
                                </div>
                            </div>
                        </div>

                        <!-- Card: Localização do Imóvel -->
                        <div
                            class="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/40 border border-slate-100 p-8">
                            <div class="flex items-center space-x-4 mb-8 pb-4 border-b border-slate-50">
                                <div class="h-12 w-12 rounded-2xl bg-slate-100 flex items-center justify-center">
                                    <i class="fas fa-location-dot text-slate-600 text-lg"></i>
                                </div>
                                <div>
                                    <h2 class="text-base font-black text-slate-700 uppercase tracking-tight">Endereço do
                                        Imóvel</h2>
                                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">
                                        Localização Geográfica</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Tipo
                                        Logr.</label>
                                    <input type="text" th:field="*{tipoLogradouro}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div class="lg:col-span-2">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Nome
                                        Logradouro</label>
                                    <input type="text" th:field="*{nomeLogradouro}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Número</label>
                                    <input type="text" th:field="*{numeroImovel}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Compl.
                                        Número</label>
                                    <input type="text" th:field="*{complementoNumeroImovel}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div>
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Bairro</label>
                                    <input type="text" th:field="*{bairro}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div class="col-span-full">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Complemento
                                        Endereço</label>
                                    <input type="text" th:field="*{complementoEndereco}"
                                        class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                </div>
                                <div class="col-span-full">
                                    <label
                                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Denominação
                                        / Localização</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <input type="text" th:field="*{denominacao}" placeholder="Denominação"
                                            class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                        <input type="text" th:field="*{localizacao}" placeholder="Localização"
                                            class="w-full bg-slate-50 border-slate-200 rounded-2xl p-3 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Scripts para Máscaras -->
        <script th:inline="javascript">
            /*<![CDATA[*/
            (function () {
                function applyMasks() {
                    var formatNI = function (v) {
                        v = v.replace(/\D/g, '');
                        if (v.length <= 11) {
                            var x = v.match(/(\d{0,3})(\d{0,3})(\d{0,3})(\d{0,2})/);
                            return !x[2] ? x[1] : x[1] + '.' + x[2] + (x[3] ? '.' + x[3] : '') + (x[4] ? '-' + x[4] : '');
                        } else {
                            var x = v.match(/(\d{0,2})(\d{0,3})(\d{0,3})(\d{0,4})(\d{0,2})/);
                            return !x[2] ? x[1] : x[1] + '.' + x[2] + '.' + x[3] + '/' + x[4] + (x[5] ? '-' + x[5] : '');
                        }
                    };

                    document.querySelectorAll('.ni-mask').forEach(function (el) {
                        el.value = formatNI(el.value);
                        el.addEventListener('input', function (e) {
                            var start = e.target.selectionStart;
                            var end = e.target.selectionEnd;
                            var oldLen = e.target.value.length;

                            e.target.value = formatNI(e.target.value);

                            var newLen = e.target.value.length;
                            if (newLen > oldLen) {
                                start += (newLen - oldLen);
                                end += (newLen - oldLen);
                            }
                            e.target.setSelectionRange(start, end);
                        });
                    });
                }
                applyMasks();
            })();
            /*]]>*/
        </script>
    </section>
</body>

</html>